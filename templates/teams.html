{% extends "base.html" %}
{% block title %}Teams - My App{% endblock %}
{% block content %}

<div class="team_top" style="width: 100%; height: 20vh; background: #ffffff; display: flex;">
    <div class="t_left"
        style="width: 30%; height: 90%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <span style="display: flex; align-items:center ; gap: 20px;">
            <img src="static/icons/teams.png" alt=""> Total submissions
        </span>
        <h2>{{ analytics["total_submissions"] }}</h2>
    </div>
    <div class="h_line" style="width: 0.5px; background: #0000001f; height: 50%; margin-top: 40px;"></div>
    <div class="submission_progress" style="width:70%; display: flex;align-items: center; margin-left: 5%;">
        <!-- Progress bar container -->
        <div style="width: 320px;">
            <div style="font-size: 20px; font-weight: 600; margin-bottom: 2px;">
                {{ analytics["total_tasks"] }} tasks
            </div>

            {% set total = analytics["total_tasks"] %}
            {% set done = analytics["total_submissions"] %}
            {% set pending = analytics.get("pending_tasks", 0) %}
            {% set missed = total - done - pending %}

            {% if total > 0 %}
                <div style="display: flex; height: 12px; border-radius: 6px; overflow: hidden; background: #f3f3f3;">
                    <div style="width: {{ (done/total*100)|round(0, 'floor') }}%; background:#29d2e4;"></div>
                    <div style="width: {{ (pending/total*100)|round(0, 'floor') }}%; background:#fdb862;"></div>
                    <div style="width: {{ (missed/total*100)|round(0, 'floor') }}%; background:#ea6c80;"></div>
                </div>
            {% else %}
                <div style="display: flex; height: 12px; border-radius: 6px; overflow: hidden; background: #f3f3f3;">
                    <div style="width: 100%; text-align: center; font-size: 12px; color: #999;">No tasks</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<div style="width: 100%; overflow-x: auto; padding: 20px;">
    <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif;">
        <thead>
            <tr style="background-color: #f9f9f9;">
                <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #ddd;">User</th>
                <th style="padding: 12px 15px; text-align: center; border-bottom: 2px solid #ddd;">Tasks</th>
                <th style="padding: 12px 15px; text-align: center; border-bottom: 2px solid #ddd;">Done</th>
                <th style="padding: 12px 15px; text-align: center; border-bottom: 2px solid #ddd;">Pending</th>
                <th style="padding: 12px 15px; text-align: center; border-bottom: 2px solid #ddd;">Missed</th>
            </tr>
        </thead>
        <tbody>
            {% for username, data in analytics["users"].items() %}
            {% set total_user = data["tasks"] %}
            {% set done_user = data["submissions"] %}
            {% set pending_user = data.get("pending", 0) %}
            {% set missed_user = total_user - done_user - pending_user %}
            <tr onclick="window.location.href='/user/{{ username }}'" style="cursor: pointer; transition: background 0.2s;">
                
                <td style="padding: 10px 15px; border-bottom: 1px solid #eee;">{{ username }}</td>
                <td style="padding: 10px 15px; text-align: center; border-bottom: 1px solid #eee;">{{ total_user }}</td>
                <td style="padding: 10px 15px; text-align: center; border-bottom: 1px solid #eee; color: #29d2e4;">{{ done_user }}</td>
                <td style="padding: 10px 15px; text-align: center; border-bottom: 1px solid #eee; color: #fdb862;">{{ pending_user }}</td>
                <td style="padding: 10px 15px; text-align: center; border-bottom: 1px solid #eee; color: #ea6c80;">{{ missed_user }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    /* Minimal hover effect for rows */
    table tbody tr:hover {
        background-color: #f1f1f1;
    }
</style>



<script>
// Make table rows clickable
document.querySelectorAll('.user-row').forEach(row => {
    row.addEventListener('click', () => {
        const href = row.getAttribute('data-href');
        if (href) {
            window.location.href = href;
        }
    });
});
</script>

{% endblock %}
